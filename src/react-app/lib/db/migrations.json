[
  {
    "sql": [
      "CREATE TABLE \"conversation_messages\" (\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n\t\"session_id\" uuid NOT NULL,\n\t\"role\" text NOT NULL,\n\t\"content\" text NOT NULL,\n\t\"token_count\" integer,\n\t\"metadata\" jsonb,\n\t\"created_at\" timestamp DEFAULT now() NOT NULL\n);\n",
      "\nCREATE TABLE \"conversation_sessions\" (\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n\t\"title\" text,\n\t\"summary\" text,\n\t\"message_count\" integer DEFAULT 0 NOT NULL,\n\t\"entity_count\" integer DEFAULT 0 NOT NULL,\n\t\"started_at\" timestamp DEFAULT now() NOT NULL,\n\t\"last_activity\" timestamp DEFAULT now() NOT NULL,\n\t\"ended_at\" timestamp\n);\n",
      "\nCREATE TABLE \"entity_contexts\" (\n\t\"entity_id\" uuid NOT NULL,\n\t\"context_id\" uuid NOT NULL,\n\t\"relevance_score\" integer DEFAULT 50 NOT NULL,\n\t\"created_at\" timestamp DEFAULT now() NOT NULL,\n\tCONSTRAINT \"entity_contexts_entity_id_context_id_pk\" PRIMARY KEY(\"entity_id\",\"context_id\")\n);\n",
      "\nCREATE TABLE \"entity_mentions\" (\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n\t\"entity_id\" uuid NOT NULL,\n\t\"message_id\" uuid NOT NULL,\n\t\"session_id\" uuid NOT NULL,\n\t\"mention_context\" text,\n\t\"created_at\" timestamp DEFAULT now() NOT NULL\n);\n",
      "\nCREATE TABLE \"entity_relationships\" (\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n\t\"from_entity_id\" uuid NOT NULL,\n\t\"to_entity_id\" uuid NOT NULL,\n\t\"relationship_type\" text NOT NULL,\n\t\"description\" text,\n\t\"strength\" integer DEFAULT 1 NOT NULL,\n\t\"created_at\" timestamp DEFAULT now() NOT NULL,\n\t\"updated_at\" timestamp DEFAULT now() NOT NULL\n);\n",
      "\nCREATE TABLE \"memory_blocks\" (\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n\t\"block_type\" text NOT NULL,\n\t\"label\" text NOT NULL,\n\t\"value\" text NOT NULL,\n\t\"metadata\" jsonb,\n\t\"char_limit\" integer DEFAULT 500 NOT NULL,\n\t\"priority\" integer DEFAULT 0 NOT NULL,\n\t\"token_cost\" integer GENERATED ALWAYS AS (CEIL(LENGTH(\"memory_blocks\".\"value\")::NUMERIC / 4)) STORED NOT NULL,\n\t\"inclusion_priority\" integer DEFAULT 50 NOT NULL,\n\t\"created_at\" timestamp DEFAULT now() NOT NULL,\n\t\"updated_at\" timestamp DEFAULT now() NOT NULL,\n\t\"last_accessed\" timestamp\n);\n",
      "\nCREATE TABLE \"memory_budget_logs\" (\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n\t\"session_id\" uuid,\n\t\"total_tokens_available\" integer NOT NULL,\n\t\"tokens_used\" integer NOT NULL,\n\t\"memories_included\" uuid[] DEFAULT '{}' NOT NULL,\n\t\"memories_excluded\" uuid[] DEFAULT '{}' NOT NULL,\n\t\"timestamp\" timestamp DEFAULT now() NOT NULL\n);\n",
      "\nCREATE TABLE \"memory_conflicts\" (\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n\t\"entity_a_id\" uuid NOT NULL,\n\t\"entity_b_id\" uuid NOT NULL,\n\t\"conflict_type\" text NOT NULL,\n\t\"resolution_status\" text DEFAULT 'pending' NOT NULL,\n\t\"resolution_entity_id\" uuid,\n\t\"resolution_strategy\" text,\n\t\"detected_at\" timestamp DEFAULT now() NOT NULL,\n\t\"resolved_at\" timestamp\n);\n",
      "\nCREATE TABLE \"memory_consolidations\" (\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n\t\"consolidation_type\" text NOT NULL,\n\t\"source_entity_ids\" uuid[] NOT NULL,\n\t\"target_entity_id\" uuid NOT NULL,\n\t\"reason\" text,\n\t\"confidence\" integer DEFAULT 50 NOT NULL,\n\t\"consolidated_at\" timestamp DEFAULT now() NOT NULL,\n\t\"consolidated_by\" text DEFAULT 'system' NOT NULL\n);\n",
      "\nCREATE TABLE \"memory_contexts\" (\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n\t\"name\" text NOT NULL,\n\t\"description\" text,\n\t\"parent_context_id\" uuid,\n\t\"active\" boolean DEFAULT true NOT NULL,\n\t\"color\" text,\n\t\"created_at\" timestamp DEFAULT now() NOT NULL,\n\t\"updated_at\" timestamp DEFAULT now() NOT NULL,\n\tCONSTRAINT \"memory_contexts_name_unique\" UNIQUE(\"name\")\n);\n",
      "\nCREATE TABLE \"memory_entities\" (\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n\t\"category\" text NOT NULL,\n\t\"name\" text NOT NULL,\n\t\"description\" text NOT NULL,\n\t\"tags\" text[] DEFAULT '{}' NOT NULL,\n\t\"confidence\" integer DEFAULT 100 NOT NULL,\n\t\"source_type\" text,\n\t\"source_session_id\" uuid,\n\t\"source_message_id\" uuid,\n\t\"mention_count\" integer DEFAULT 1 NOT NULL,\n\t\"last_mentioned\" timestamp DEFAULT now() NOT NULL,\n\t\"importance_score\" integer DEFAULT 50 NOT NULL,\n\t\"memory_tier\" text DEFAULT 'short_term' NOT NULL,\n\t\"access_count\" integer DEFAULT 0 NOT NULL,\n\t\"last_accessed\" timestamp,\n\t\"promotion_score\" integer DEFAULT 0 NOT NULL,\n\t\"decay_rate\" integer DEFAULT 10 NOT NULL,\n\t\"last_reinforced\" timestamp DEFAULT now() NOT NULL,\n\t\"current_strength\" integer DEFAULT 100 NOT NULL,\n\t\"memory_type\" text DEFAULT 'semantic' NOT NULL,\n\t\"token_cost\" integer GENERATED ALWAYS AS (CEIL(LENGTH(\"memory_entities\".\"name\" || ' ' || \"memory_entities\".\"description\")::NUMERIC / 4)) STORED NOT NULL,\n\t\"created_at\" timestamp DEFAULT now() NOT NULL,\n\t\"updated_at\" timestamp DEFAULT now() NOT NULL\n);\n",
      "\nCREATE TABLE \"memory_episodes\" (\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n\t\"session_id\" uuid NOT NULL,\n\t\"event_type\" text NOT NULL,\n\t\"content\" text NOT NULL,\n\t\"related_entity_ids\" uuid[] DEFAULT '{}' NOT NULL,\n\t\"temporal_order\" integer NOT NULL,\n\t\"emotional_context\" text,\n\t\"created_at\" timestamp DEFAULT now() NOT NULL\n);\n",
      "\nCREATE TABLE \"memory_retrieval_logs\" (\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n\t\"session_id\" uuid,\n\t\"query_text\" text,\n\t\"query_type\" text,\n\t\"retrieved_entity_ids\" jsonb,\n\t\"retrieval_scores\" jsonb,\n\t\"retrieval_time_ms\" integer,\n\t\"result_count\" integer DEFAULT 0 NOT NULL,\n\t\"created_at\" timestamp DEFAULT now() NOT NULL\n);\n",
      "\nCREATE TABLE \"memory_triggers\" (\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n\t\"entity_id\" uuid NOT NULL,\n\t\"trigger_type\" text NOT NULL,\n\t\"trigger_value\" text NOT NULL,\n\t\"strength\" integer DEFAULT 50 NOT NULL,\n\t\"created_at\" timestamp DEFAULT now() NOT NULL\n);\n",
      "\nALTER TABLE \"conversation_messages\" ADD CONSTRAINT \"conversation_messages_session_id_conversation_sessions_id_fk\" FOREIGN KEY (\"session_id\") REFERENCES \"public\".\"conversation_sessions\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"entity_contexts\" ADD CONSTRAINT \"entity_contexts_entity_id_memory_entities_id_fk\" FOREIGN KEY (\"entity_id\") REFERENCES \"public\".\"memory_entities\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"entity_contexts\" ADD CONSTRAINT \"entity_contexts_context_id_memory_contexts_id_fk\" FOREIGN KEY (\"context_id\") REFERENCES \"public\".\"memory_contexts\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"entity_mentions\" ADD CONSTRAINT \"entity_mentions_entity_id_memory_entities_id_fk\" FOREIGN KEY (\"entity_id\") REFERENCES \"public\".\"memory_entities\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"entity_mentions\" ADD CONSTRAINT \"entity_mentions_message_id_conversation_messages_id_fk\" FOREIGN KEY (\"message_id\") REFERENCES \"public\".\"conversation_messages\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"entity_mentions\" ADD CONSTRAINT \"entity_mentions_session_id_conversation_sessions_id_fk\" FOREIGN KEY (\"session_id\") REFERENCES \"public\".\"conversation_sessions\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"entity_relationships\" ADD CONSTRAINT \"entity_relationships_from_entity_id_memory_entities_id_fk\" FOREIGN KEY (\"from_entity_id\") REFERENCES \"public\".\"memory_entities\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"entity_relationships\" ADD CONSTRAINT \"entity_relationships_to_entity_id_memory_entities_id_fk\" FOREIGN KEY (\"to_entity_id\") REFERENCES \"public\".\"memory_entities\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"memory_budget_logs\" ADD CONSTRAINT \"memory_budget_logs_session_id_conversation_sessions_id_fk\" FOREIGN KEY (\"session_id\") REFERENCES \"public\".\"conversation_sessions\"(\"id\") ON DELETE set null ON UPDATE no action;",
      "\nALTER TABLE \"memory_conflicts\" ADD CONSTRAINT \"memory_conflicts_entity_a_id_memory_entities_id_fk\" FOREIGN KEY (\"entity_a_id\") REFERENCES \"public\".\"memory_entities\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"memory_conflicts\" ADD CONSTRAINT \"memory_conflicts_entity_b_id_memory_entities_id_fk\" FOREIGN KEY (\"entity_b_id\") REFERENCES \"public\".\"memory_entities\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"memory_conflicts\" ADD CONSTRAINT \"memory_conflicts_resolution_entity_id_memory_entities_id_fk\" FOREIGN KEY (\"resolution_entity_id\") REFERENCES \"public\".\"memory_entities\"(\"id\") ON DELETE no action ON UPDATE no action;",
      "\nALTER TABLE \"memory_consolidations\" ADD CONSTRAINT \"memory_consolidations_target_entity_id_memory_entities_id_fk\" FOREIGN KEY (\"target_entity_id\") REFERENCES \"public\".\"memory_entities\"(\"id\") ON DELETE no action ON UPDATE no action;",
      "\nALTER TABLE \"memory_contexts\" ADD CONSTRAINT \"memory_contexts_parent_context_id_memory_contexts_id_fk\" FOREIGN KEY (\"parent_context_id\") REFERENCES \"public\".\"memory_contexts\"(\"id\") ON DELETE no action ON UPDATE no action;",
      "\nALTER TABLE \"memory_episodes\" ADD CONSTRAINT \"memory_episodes_session_id_conversation_sessions_id_fk\" FOREIGN KEY (\"session_id\") REFERENCES \"public\".\"conversation_sessions\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"memory_retrieval_logs\" ADD CONSTRAINT \"memory_retrieval_logs_session_id_conversation_sessions_id_fk\" FOREIGN KEY (\"session_id\") REFERENCES \"public\".\"conversation_sessions\"(\"id\") ON DELETE set null ON UPDATE no action;",
      "\nALTER TABLE \"memory_triggers\" ADD CONSTRAINT \"memory_triggers_entity_id_memory_entities_id_fk\" FOREIGN KEY (\"entity_id\") REFERENCES \"public\".\"memory_entities\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nCREATE INDEX \"conv_messages_session_idx\" ON \"conversation_messages\" USING btree (\"session_id\");",
      "\nCREATE INDEX \"conv_messages_created_idx\" ON \"conversation_messages\" USING btree (\"created_at\");",
      "\nCREATE INDEX \"conv_messages_role_idx\" ON \"conversation_messages\" USING btree (\"role\");",
      "\nCREATE INDEX \"conv_sessions_started_idx\" ON \"conversation_sessions\" USING btree (\"started_at\");",
      "\nCREATE INDEX \"conv_sessions_last_activity_idx\" ON \"conversation_sessions\" USING btree (\"last_activity\");",
      "\nCREATE INDEX \"entity_contexts_entity_idx\" ON \"entity_contexts\" USING btree (\"entity_id\");",
      "\nCREATE INDEX \"entity_contexts_context_idx\" ON \"entity_contexts\" USING btree (\"context_id\");",
      "\nCREATE INDEX \"entity_mentions_entity_idx\" ON \"entity_mentions\" USING btree (\"entity_id\");",
      "\nCREATE INDEX \"entity_mentions_message_idx\" ON \"entity_mentions\" USING btree (\"message_id\");",
      "\nCREATE INDEX \"entity_mentions_session_idx\" ON \"entity_mentions\" USING btree (\"session_id\");",
      "\nCREATE INDEX \"entity_mentions_created_idx\" ON \"entity_mentions\" USING btree (\"created_at\");",
      "\nCREATE INDEX \"entity_rel_from_idx\" ON \"entity_relationships\" USING btree (\"from_entity_id\");",
      "\nCREATE INDEX \"entity_rel_to_idx\" ON \"entity_relationships\" USING btree (\"to_entity_id\");",
      "\nCREATE INDEX \"entity_rel_type_idx\" ON \"entity_relationships\" USING btree (\"relationship_type\");",
      "\nCREATE INDEX \"memory_blocks_type_idx\" ON \"memory_blocks\" USING btree (\"block_type\");",
      "\nCREATE INDEX \"memory_blocks_priority_idx\" ON \"memory_blocks\" USING btree (\"priority\");",
      "\nCREATE INDEX \"memory_blocks_updated_idx\" ON \"memory_blocks\" USING btree (\"updated_at\");",
      "\nCREATE INDEX \"memory_blocks_inclusion_idx\" ON \"memory_blocks\" USING btree (\"inclusion_priority\");",
      "\nCREATE INDEX \"budget_logs_session_idx\" ON \"memory_budget_logs\" USING btree (\"session_id\");",
      "\nCREATE INDEX \"budget_logs_timestamp_idx\" ON \"memory_budget_logs\" USING btree (\"timestamp\");",
      "\nCREATE INDEX \"conflicts_status_idx\" ON \"memory_conflicts\" USING btree (\"resolution_status\");",
      "\nCREATE INDEX \"conflicts_type_idx\" ON \"memory_conflicts\" USING btree (\"conflict_type\");",
      "\nCREATE INDEX \"consolidations_target_idx\" ON \"memory_consolidations\" USING btree (\"target_entity_id\");",
      "\nCREATE INDEX \"consolidations_type_idx\" ON \"memory_consolidations\" USING btree (\"consolidation_type\");",
      "\nCREATE INDEX \"contexts_name_idx\" ON \"memory_contexts\" USING btree (\"name\");",
      "\nCREATE INDEX \"contexts_parent_idx\" ON \"memory_contexts\" USING btree (\"parent_context_id\");",
      "\nCREATE INDEX \"memory_entities_category_idx\" ON \"memory_entities\" USING btree (\"category\");",
      "\nCREATE INDEX \"memory_entities_tags_idx\" ON \"memory_entities\" USING btree (\"tags\");",
      "\nCREATE INDEX \"memory_entities_mention_count_idx\" ON \"memory_entities\" USING btree (\"mention_count\");",
      "\nCREATE INDEX \"memory_entities_last_mentioned_idx\" ON \"memory_entities\" USING btree (\"last_mentioned\");",
      "\nCREATE INDEX \"memory_entities_importance_idx\" ON \"memory_entities\" USING btree (\"importance_score\");",
      "\nCREATE INDEX \"memory_entities_name_idx\" ON \"memory_entities\" USING btree (\"name\");",
      "\nCREATE INDEX \"memory_entities_tier_idx\" ON \"memory_entities\" USING btree (\"memory_tier\");",
      "\nCREATE INDEX \"memory_entities_access_count_idx\" ON \"memory_entities\" USING btree (\"access_count\");",
      "\nCREATE INDEX \"memory_entities_last_accessed_idx\" ON \"memory_entities\" USING btree (\"last_accessed\");",
      "\nCREATE INDEX \"memory_entities_strength_idx\" ON \"memory_entities\" USING btree (\"current_strength\");",
      "\nCREATE INDEX \"memory_entities_type_idx\" ON \"memory_entities\" USING btree (\"memory_type\");",
      "\nCREATE INDEX \"episodes_session_idx\" ON \"memory_episodes\" USING btree (\"session_id\");",
      "\nCREATE INDEX \"episodes_temporal_idx\" ON \"memory_episodes\" USING btree (\"temporal_order\");",
      "\nCREATE INDEX \"episodes_type_idx\" ON \"memory_episodes\" USING btree (\"event_type\");",
      "\nCREATE INDEX \"memory_retrieval_session_idx\" ON \"memory_retrieval_logs\" USING btree (\"session_id\");",
      "\nCREATE INDEX \"memory_retrieval_created_idx\" ON \"memory_retrieval_logs\" USING btree (\"created_at\");",
      "\nCREATE INDEX \"triggers_entity_idx\" ON \"memory_triggers\" USING btree (\"entity_id\");",
      "\nCREATE INDEX \"triggers_type_idx\" ON \"memory_triggers\" USING btree (\"trigger_type\");",
      "\nCREATE INDEX \"triggers_value_idx\" ON \"memory_triggers\" USING btree (\"trigger_value\");"
    ],
    "bps": true,
    "folderMillis": 1759695941672,
    "hash": "eede5c469d17580c3591966c98aa98937f5b8562dd8ff578f140b61223c53051"
  },
  {
    "sql": [
      "CREATE TABLE \"sql_execution_log\" (\n\t\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n\t\"query\" text NOT NULL,\n\t\"source\" text NOT NULL,\n\t\"success\" boolean NOT NULL,\n\t\"rows_affected\" integer,\n\t\"error_message\" text,\n\t\"execution_time_ms\" integer,\n\t\"executed_at\" timestamp DEFAULT now() NOT NULL\n);\n",
      "\nCREATE INDEX \"sql_log_source_idx\" ON \"sql_execution_log\" USING btree (\"source\");",
      "\nCREATE INDEX \"sql_log_executed_idx\" ON \"sql_execution_log\" USING btree (\"executed_at\");",
      "\nCREATE INDEX \"sql_log_success_idx\" ON \"sql_execution_log\" USING btree (\"success\");"
    ],
    "bps": true,
    "folderMillis": 1759698215586,
    "hash": "26031320341198e4a70f6a96ea73ae4631fb64581eb708fe4ba7098de6cad0b4"
  },
  {
    "sql": [
      "ALTER TABLE \"sql_execution_log\" ADD COLUMN \"result_data\" jsonb;"
    ],
    "bps": true,
    "folderMillis": 1759702729980,
    "hash": "0ee47fc7b3b48247d4db6923cf1a5d4547b65b14807fdb764f3fe63f5aecbd8b"
  }
]